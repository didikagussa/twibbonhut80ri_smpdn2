<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Twibbon Kustom</title>
    <!-- Menggunakan Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Menggunakan font Inter dari Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Style kustom untuk body dan canvas */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Membuat canvas dan frame twibbon responsif dan menjaga rasio aspek */
        .canvas-container {
            position: relative;
            width: 100%;
            padding-top: 100%; /* 1:1 Aspect Ratio */
            background-color: #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            cursor: move;
        }
        canvas, #twibbonFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        /* Menyembunyikan frame sampai gambar twibbon berhasil dimuat */
        #twibbonFrame {
            pointer-events: none; /* Agar frame tidak menghalangi interaksi mouse dengan canvas */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 w-full max-w-lg">
        
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800">Buat Twibbon Anda</h1>
            <p class="text-gray-500 mt-2">Unggah foto Anda untuk dipasangkan dengan bingkai.</p>
        </div>

        <!-- Area Canvas dan Frame -->
        <div id="canvasContainer" class="canvas-container mb-6">
            <canvas id="twibbonCanvas"></canvas>
            <!-- Gambar frame twibbon akan ditampilkan di atas canvas -->
            <img id="twibbonFrame" src="" alt="Bingkai Twibbon" 
                 onerror="this.onerror=null; this.src='https://placehold.co/500x500/e0e0e0/777?text=Gagal+Memuat+Twibbon';">
        </div>

        <!-- Kontrol Pengguna -->
        <div class="space-y-4">
            <!-- Tombol Upload Foto -->
            <div>
                <label for="imageLoader" class="w-full inline-block text-center bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg cursor-pointer hover:bg-blue-700 transition-colors duration-300">
                    Pilih Foto
                </label>
                <input type="file" id="imageLoader" class="hidden" accept="image/*">
            </div>

            <!-- Slider untuk Scale/Zoom -->
            <div class="space-y-2">
                <label for="scaleSlider" class="font-medium text-gray-700">Atur Ukuran Foto</label>
                <input id="scaleSlider" type="range" min="0.1" max="3" step="0.01" value="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" disabled>
            </div>

            <!-- Tombol Download -->
            <button id="downloadBtn" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                Unduh Hasil
            </button>
        </div>
        
    </div>

    <script>
        // --- GANTI URL TWIBBON DI SINI ---
        // Ganti URL di bawah ini dengan URL gambar PNG transparan Anda.
        // Anda bisa mengupload gambar twibbon Anda ke imgbb.com, postimages.org, atau hosting gambar lainnya.
        const twibbonImageUrl = 'https://i.postimg.cc/5yczDdzr/TWIBBON-HUT-RI.png'; 
        // URL contoh: 'https://i.ibb.co/dG7n8z3/twibbon-frame-example.png'
        // Placeholder jika URL kosong: 'https://placehold.co/500x500/000000/FFFFFF?text=Letakkan+Twibbon+Disini'

        // Mendapatkan elemen-elemen dari DOM
        const canvas = document.getElementById('twibbonCanvas');
        const ctx = canvas.getContext('2d');
        const imageLoader = document.getElementById('imageLoader');
        const scaleSlider = document.getElementById('scaleSlider');
        const downloadBtn = document.getElementById('downloadBtn');
        const twibbonFrame = document.getElementById('twibbonFrame');

        // Variabel untuk menyimpan state gambar
        let userImage = null;
        let scale = 1;
        let offsetX = 0;
        let offsetY = 0;

        // Variabel untuk fungsionalitas drag/geser gambar
        let isDragging = false;
        let startDrag = { x: 0, y: 0 };

        // --- Inisialisasi ---
        // Set sumber gambar untuk frame twibbon
        twibbonFrame.src = twibbonImageUrl;

        // Saat gambar frame berhasil dimuat, atur ukuran canvas agar sesuai
        twibbonFrame.onload = () => {
            // Menggunakan naturalWidth/Height untuk mendapatkan ukuran asli gambar
            const frameWidth = twibbonFrame.naturalWidth;
            const frameHeight = twibbonFrame.naturalHeight;
            
            // Mengatur aspek rasio container berdasarkan gambar frame
            const canvasContainer = document.getElementById('canvasContainer');
            canvasContainer.style.paddingTop = `${(frameHeight / frameWidth) * 100}%`;

            // Mengatur resolusi canvas agar sesuai dengan gambar frame
            canvas.width = frameWidth;
            canvas.height = frameHeight;
            
            drawInitialMessage();
        };
        
        function drawInitialMessage() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#6b7280';
            ctx.font = '24px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('Silakan unggah foto Anda', canvas.width / 2, canvas.height / 2);
        }

        // --- Event Listeners ---
        imageLoader.addEventListener('change', handleImageUpload);
        scaleSlider.addEventListener('input', handleScaling);
        downloadBtn.addEventListener('click', downloadImage);

        // Event listeners untuk menggeser gambar (mouse)
        canvas.addEventListener('mousedown', startDragging);
        canvas.addEventListener('mousemove', dragImage);
        canvas.addEventListener('mouseup', stopDragging);
        canvas.addEventListener('mouseleave', stopDragging);
        
        // Event listeners untuk menggeser gambar (touch)
        canvas.addEventListener('touchstart', startDragging, { passive: false });
        canvas.addEventListener('touchmove', dragImage, { passive: false });
        canvas.addEventListener('touchend', stopDragging);

        // --- Fungsi-fungsi Handler ---

        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                userImage = new Image();
                userImage.onload = () => {
                    // Reset posisi dan skala saat gambar baru diunggah
                    offsetX = canvas.width / 2;
                    offsetY = canvas.height / 2;
                    scale = 1;
                    scaleSlider.value = 1;
                    
                    // Aktifkan kontrol
                    scaleSlider.disabled = false;
                    downloadBtn.disabled = false;
                    
                    drawImage();
                };
                userImage.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }

        function handleScaling(e) {
            if (!userImage) return;
            scale = parseFloat(e.target.value);
            drawImage();
        }

        // --- Fungsi Drag & Drop ---

        function getEventPosition(e) {
            if (e.touches && e.touches.length > 0) {
                const rect = canvas.getBoundingClientRect();
                return {
                    x: e.touches[0].clientX - rect.left,
                    y: e.touches[0].clientY - rect.top
                };
            }
            return { x: e.offsetX, y: e.offsetY };
        }

        function startDragging(e) {
            if (!userImage) return;
            e.preventDefault();
            isDragging = true;
            const pos = getEventPosition(e);
            startDrag.x = pos.x - (offsetX * (canvas.clientWidth / canvas.width));
            startDrag.y = pos.y - (offsetY * (canvas.clientHeight / canvas.height));
        }

        function dragImage(e) {
            if (isDragging && userImage) {
                e.preventDefault();
                const pos = getEventPosition(e);
                offsetX = (pos.x - startDrag.x) * (canvas.width / canvas.clientWidth);
                offsetY = (pos.y - startDrag.y) * (canvas.height / canvas.clientHeight);
                drawImage();
            }
        }

        function stopDragging() {
            isDragging = false;
        }

        // --- Fungsi Utama untuk Menggambar ---

        function drawImage() {
            if (!userImage) return;
            
            // Bersihkan canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            
            // Gambar foto pengguna dengan posisi dan skala yang telah diatur
            const scaledWidth = userImage.width * scale;
            const scaledHeight = userImage.height * scale;

            ctx.drawImage(
                userImage,
                offsetX - scaledWidth / 2,
                offsetY - scaledHeight / 2,
                scaledWidth,
                scaledHeight
            );
            
            ctx.restore();
        }

        // --- Fungsi untuk Mengunduh Gambar ---

        function downloadImage() {
            if (!userImage) return;

            // Buat canvas sementara untuk menggabungkan gambar
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;

            // 1. Gambar foto pengguna ke canvas sementara
            const scaledWidth = userImage.width * scale;
            const scaledHeight = userImage.height * scale;
            tempCtx.drawImage(
                userImage,
                offsetX - scaledWidth / 2,
                offsetY - scaledHeight / 2,
                scaledWidth,
                scaledHeight
            );
            
            // 2. Gambar frame twibbon di atasnya
            tempCtx.drawImage(twibbonFrame, 0, 0, tempCanvas.width, tempCanvas.height);

            // 3. Buat link untuk mengunduh hasilnya
            const link = document.createElement('a');
            link.download = 'twibbon-hasil.png';
            link.href = tempCanvas.toDataURL('image/png');
            link.click();
        }
    </script>

</body>
</html>
